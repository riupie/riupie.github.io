I"W<p>Variabel dalam ansible terdiri dari 3 <em>scope level</em> yaitu:</p>
<ul>
  <li>Global scope	: Terdapat di ansible.cfg</li>
  <li>Play scope	: Terdapat dalam playbook</li>
  <li>Host scope	: Terdapat dalam inventory, fact gathering atau task.</li>
</ul>

<p>Jika terdapat variabel yang sama diantara ketiganya, maka alur overriding nya adalah host variabel&gt;play variabel&gt;global variabel. Misal terdapat variabel yang sama pada global dan host maka yang akan digunakan adalah variabel pada host.</p>

<h3 id="pendefinisian-variabel-pada-playbook">Pendefinisian Variabel pada Playbook</h3>

<p>Pendefinisian variabel dapat dilakukan dengan mendefinisikannya langsung pada playbook atau melalui sebuah file variabel. Berikut perbedaannya:</p>

<h4 id="secara-langsung">Secara langsung</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

- hosts: all
    vars:
      user: riupie
      home: /home/riupie
  tasks:
    - name: Membuat user 
      user:
        name: ""		# Jika variabel digunakan untuk memulai sebuah value maka harus diberi double quote
...

</code></pre></div></div>

<h4 id="secara-tidak-langsung">Secara tidak langsung</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

- hosts: all
    vars_files:
      - vars/users.yml
...

</code></pre></div></div>
<p>Lalu pada direktori vars dibuat file users.yml.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user: riupie
home: /home/riupie
</code></pre></div></div>
<h3 id="pendefinisian-variabel-pada-host">Pendefinisian variabel pada host</h3>
<p>Pendefinisian variabel pada host dapat dilakukan dengan beberapa cara, misal dengan mendefinisikan langsung pada file inventory.</p>

<h4 id="untuk-satu-host">Untuk satu host</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[servers]
demo.example.com  	ansible_user=riupie
</code></pre></div></div>
<h4 id="untuk-group">Untuk group</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[servers]
servera.rahmatawe.com
serverb.rahmatawe.com

[servers:vars]
ansible_user=riupie
</code></pre></div></div>
<h4 id="host-varibel-dengan-direktori-group_vars-dan-host_vars">Host Varibel dengan direktori group_vars dan host_vars</h4>

<p>Untuk pendefinisian host variabel yang lebih rapi bisa dengan membuat direktori 
group_vars untuk menyimpan variabel sebuah grup dan direktori host_vars untuk menyimpan variabel spesifik suatu host. Lalu di dalam masing-masing direktori tersebut dibuat file-file dengan nama sesuai dengan nama grup atau host yang dimaksud. Selanjutnya didalam file tersebut barulah didefinisikan variabel-variabel nya. Berikut ini struktur dari file-file tersebut.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>project
├── ansible.cfg
├── group_vars
│   │
│   ├── dbservers
│   │   
│   └── datacenters2
├── host_vars
│   │
│   ├── servera.rahmatawe.com
│   │
│   ├── serverb.rahmatawe.com
│   │
│   └── serverc.rahmatawe.com
├── inventory
└── playbook.yml

</code></pre></div></div>

<h3 id="penulisan-variabel-dengan-arrays">Penulisan Variabel dengan Arrays</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>users:
  rahmat:
    first_name: Rahmat 
    last_name: Agung
    home_dir: /users/rahmat
  ari:
    first_name: Ari
    last_name: Wibowo
    home_dir: /users/ari
</code></pre></div></div>
<p>Untuk pemanggilan variabel diatas didalam playbook dapat dilakukan dengan cara sebagai berikut.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Cara 1. Return Rahmat
users['rahmat']['first_name']

#Cara 2. Return Ari
users.ari.first_name
</code></pre></div></div>

<h3 id="menyimpan-output-task">Menyimpan Output Task</h3>

<p>Output dari sebuah task dapat disimpan ke dalam sebuah variabel dengan menggunakan parameter <em>register</em>. Tujuan penggunaan biasanya untuk <em>debugging</em>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
- name: Installs webserver
  hosts: all
  tasks:
    - name: Install httpd
      yum:
        name: httpd
        state: installed
      register: install_output
    
    - debug: var=install_output
</code></pre></div></div>

<h3 id="vault-sebuah-cara-menyimpan-variabel-yang-bersifat-confidential">Vault: Sebuah cara menyimpan variabel yang bersifat confidential</h3>

<p>Vault merupakan sebuah file yang digunakan untuk menyimpan variabel-variabel yang sensitif dan bersifat rahasia seperti password, token, dll. Variabel-variabel yang tersimpan di dalam vault akan terenkripsi.</p>

<h4 id="membuat-file-vault-baru">Membuat file vault baru</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ansible-vault create vault
Vault password: rahasia
</code></pre></div></div>

<h4 id="melihat-vault">Melihat vault</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-vault view vault
</code></pre></div></div>

<h4 id="membuat-file-vault-dengan-password-dari-sebuah-file">Membuat file vault dengan password dari sebuah file</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-vault create vault --vault-password-file=secret
</code></pre></div></div>

<h4 id="membuat-vault-dari-existing-file">Membuat vault dari <em>existing</em> file</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-vault encrypt test-vault --output=vault
</code></pre></div></div>

<h4 id="menjalankan-vault-dalam-playbook">Menjalankan vault dalam Playbook</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook --vault-id @prompt mypkaybook.yml
</code></pre></div></div>

<h3 id="ansible-fact">Ansible Fact</h3>

<p>Fact merupakan variabel-variabel yang secara otomatis di <em>generate</em> oleh Ansible dan berisi informasi mengenai host.</p>

<h4 id="menampilkan-fact-dengan-playbook">Menampilkan Fact dengan Playbook</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
- name: Dump Fact dengan Playbook
  hosts: all
  tasks:
    - name: Print semua facts
      debug:
        var: ansible_facts
</code></pre></div></div>

<h4 id="menampilkan-fact-dengan-ad-hoc">Menampilkan Fact dengan Ad-Hoc</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible servera.lab.com -m setup
</code></pre></div></div>

<h4 id="mematikan-fact-gathering">Mematikan Fact Gathering</h4>
<p>Terkadang kita perlu mematikan fact gathering untuk mempercepat running ansible.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
- name: Matikan fact
  hosts: webserver
  gather_facts: no

. . .
</code></pre></div></div>

<h4 id="custom-fact">Custom Fact</h4>

<p>Custom Fact bisa dibuat di direktori /etc/ansible/fact.d. Di dalam direktori ini kemudian bisa dibuat file fact dengan format *.fact.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[packages]
web_package = httpd
db_package = mariadb-server
</code></pre></div></div>
<p>File fact diatas dapat dipanggil dengan variabel ansible_facts.ansible_local[‘packages’][‘web_package’].</p>

<hr />
:ET